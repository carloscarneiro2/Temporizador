<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jornada do Colaborador</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding:0;
      background:#0a192f;
      color:#e5e7eb;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    header img {
      width:100%;
      max-height:180px;
      object-fit:cover;
      display:block;
    }
    h1 {
      margin:15px 0;
      font-size:22px;
      color:#f9fafb;
      text-shadow: 1px 1px 2px #6b7280;
    }
    .container {
      background:#0f172a;
      padding:15px;
      border-radius:8px;
      width:90%;
      max-width:700px;
      margin-bottom:15px;
    }
    label { display:block; margin-top:8px; }
    input[type="text"] {
      width:100%;
      padding:8px;
      margin-top:4px;
      border:1px solid #374151;
      border-radius:4px;
      background:#1e293b;
      color:#fff;
    }
    .top-actions { display:flex; justify-content:flex-end; margin-top:10px; }
    .export {
      background:#0ea5e9; color:#fff; border:none;
      padding:8px 12px; border-radius:6px; font-weight:700; cursor:pointer;
    }
    .export:hover { background:#22d3ee; color:#0f172a; }
    .botoes-etapas {
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
      margin-top:15px;
    }
    .botoes-etapas button {
      padding:12px;
      border:none;
      border-radius:6px;
      font-size:15px;
      font-weight:bold;
      color:#fff;
      cursor:pointer;
      opacity:0.6;
    }
    .botoes-etapas button.ativo { opacity:1; border:2px solid #fff; }
    .azul { background:#2563eb; }
    .verde { background:#16a34a; }
    .vermelho { background:#b91c1c; }
    .amarelo { background:#ca8a04; }
    .conteudo-etapa {
      background:#1e293b;
      padding:15px;
      border-radius:8px;
      margin-top:20px;
      width:90%;
      max-width:700px;
    }
    ul { list-style:none; padding-left:0; }
    li { margin-bottom:10px; }
    input[type="checkbox"] { margin-right:6px; }
    button.coment {
      background:#374151;
      color:#fff;
      border:none;
      padding:4px 8px;
      margin-left:8px;
      cursor:pointer;
      border-radius:4px;
    }
    .comentario {
      display:none;
      width:100%;
      height:50px;
      margin-top:5px;
      background:#0f172a;
      color:#fff;
      border:1px solid #374151;
      border-radius:4px;
      padding:6px;
    }
    .encerrar {
      margin-top:15px;
      background:#16a34a;
      padding:8px 14px;
      border:none;
      border-radius:6px;
      font-size:14px;
      cursor:pointer;
      color:#fff;
    }
  </style>
</head>
<body>
  <header>
    <img src="d9eae419-6695-4097-a256-b6c9ebc981ce.jpeg" alt="Vidro Cebrace">
  </header>

  <h1>Jornada do Colaborador</h1>

  <div class="container">
    <label for="re">Digite o RE:</label>
    <input type="text" id="re" placeholder="Ex: 123456">
    <label for="nome">Nome do Colaborador:</label>
    <input type="text" id="nome" placeholder="Nome ser치 exibido aqui" readonly>

    <div class="top-actions">
      <button class="export" onclick="exportarCSV()">Extrair para Excel</button>
    </div>
  </div>

  <div class="botoes-etapas">
    <button id="btn-aprender" class="azul ativo">Aprender</button>
    <button id="btn-aplicar" class="verde">Aplicar</button>
    <button id="btn-reconhecido" class="vermelho">Ser Reconhecido</button>
    <button id="btn-liderar" class="amarelo">Liderar</button>
    <button id="btn-ensinar" class="azul">Ensinar</button>
    <button id="btn-multiplicar" class="verde">Multiplicar</button>
  </div>

  <div class="conteudo-etapa" id="conteudo-etapa">
    <h3 style="color:#3b82f6;">Etapa 1 - Aprender</h3>
    <p><strong>Objetivo:</strong> Assimilar fundamentos do Fluxo Vivo.</p>
    <ul>
      <li><input type="checkbox"> Participar do treinamento inicial (15 min).
        <button class="coment" onclick="toggleComentario(this)">Inserir coment치rio</button>
        <textarea class="comentario"></textarea>
      </li>
      <li><input type="checkbox"> Ler o material de apoio (folheto ou mural).
        <button class="coment" onclick="toggleComentario(this)">Inserir coment치rio</button>
        <textarea class="comentario"></textarea>
      </li>
      <li><input type="checkbox"> Observar colega experiente em atividade (On The Job).
        <button class="coment" onclick="toggleComentario(this)">Inserir coment치rio</button>
        <textarea class="comentario"></textarea>
      </li>
      <li><input type="checkbox"> Preencher checklist com supervis칚o (1x).
        <button class="coment" onclick="toggleComentario(this)">Inserir coment치rio</button>
        <textarea class="comentario"></textarea>
      </li>
      <li><input type="checkbox"> Explicar um pilar do Fluxo Vivo em poucas palavras.
        <button class="coment" onclick="toggleComentario(this)">Inserir coment치rio</button>
        <textarea class="comentario"></textarea>
      </li>
    </ul>
    <button class="encerrar" onclick="encerrarEtapa('aprender','aplicar')">Encerrar Etapa</button>
  </div>

  <script>
    const mockData = { "123456": "Carlos Alberto", "654321": "Maria Souza" };
    document.getElementById("re").addEventListener("input", function() {
      const re = this.value.trim();
      document.getElementById("nome").value = mockData[re] || "";
    });

    function toggleComentario(botao) {
      const textarea = botao.nextElementSibling;
      textarea.style.display = (textarea.style.display === "none" || textarea.style.display === "") ? "block" : "none";
    }

    function encerrarEtapa(atual, proxima) {
      const checkboxes = document.querySelectorAll('#conteudo-etapa input[type="checkbox"]');
      let todosMarcados = true;
      checkboxes.forEach(cb => { if (!cb.checked) todosMarcados = false; });
      if (!todosMarcados) {
        alert("丘멆잺 Complete todas as tarefas antes de encerrar esta etapa.");
        return;
      }
      document.getElementById("btn-" + atual).classList.remove("ativo");
      document.getElementById("btn-" + atual).disabled = true;
      if (proxima) {
        document.getElementById("btn-" + proxima).classList.add("ativo");
        carregarEtapa(proxima);
      } else {
        alert("游꿀 Todas as etapas conclu칤das!");
      }
    }

    function carregarEtapa(etapa) {
      let conteudo = document.getElementById("conteudo-etapa");
      if (etapa === "aplicar") {
        conteudo.innerHTML = `<h3 style="color:#16a34a;">Etapa 2 - Aplicar</h3>
        <p><strong>Objetivo:</strong> Converter conhecimento em pr치tica disciplinada.</p>
        <ul>
          <li><input type="checkbox"> Preencher checklists durante 1 semana.</li>
          <li><input type="checkbox"> Executar pelo menos 1 sugest칚o simples de melhoria.</li>
          <li><input type="checkbox"> Reportar uma n칚o conformidade ao supervisor.</li>
          <li><input type="checkbox"> Receber feedback do supervisor.</li>
          <li><input type="checkbox"> Participar de uma rotina de melhoria (ex.: 6S).</li>
        </ul>
        <button class="encerrar" onclick="encerrarEtapa('aplicar','reconhecido')">Encerrar Etapa</button>`;
      }
    }

    // --- NOVO: Exportar para Excel (CSV) da etapa atual vis칤vel ---
    function exportarCSV() {
      const re = document.getElementById('re').value || '';
      const nome = document.getElementById('nome').value || '';

      const etapaTituloEl = document.querySelector('#conteudo-etapa h3');
      const etapaTitulo = etapaTituloEl ? etapaTituloEl.textContent.trim() : 'Etapa';

      const linhas = [];
      const itens = document.querySelectorAll('#conteudo-etapa ul li');

      itens.forEach((li, idx) => {
        const chk = li.querySelector('input[type="checkbox"]');
        const feito = chk && chk.checked ? 'Sim' : 'N칚o';
        const txtParts = [];
        li.childNodes.forEach(n => {
          if (n.nodeType === 3) { // texto direto
            const t = n.textContent.trim();
            if (t) txtParts.push(t);
          }
        });
        let tarefa = txtParts.join(' ').replace(/\s+/g, ' ');
        if (!tarefa) {
          // fallback: usa innerText sem o texto do bot칚o
          tarefa = (li.innerText || '').replace('Inserir coment치rio','').trim();
        }
        const comentario = (li.querySelector('textarea.comentario')?.value || '').trim();
        linhas.push([re, nome, etapaTitulo, idx+1, tarefa, feito, comentario]);
      });

      let csv = 'RE,Nome,Etapa,Ordem,Tarefa,Feito,Coment치rio\n';
      linhas.forEach(row => {
        const line = row.map(v => '"'+String(v).replace(/"/g,'""')+'"').join(',');
        csv += line + '\n';
      });

      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      // usa parte do t칤tulo da etapa no nome do arquivo
      const etapaKey = etapaTitulo.toLowerCase().split(' - ').pop().replace(/\s+/g,'_');
      a.download = `jornada_${etapaKey}_${(re||'semRE')}.csv`;
      a.click();
    }
  </script>
</body>
</html>
